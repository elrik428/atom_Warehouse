------   To check versions for tid list
select appnm, famnm, count(*)   from vc30.relation where
TERMID IN
('00001548','00007005','00014113','00015208','00017872')
AND substring(appnm,1,4) = ('PIRA')
 and substring(appnm,9,1) = ('P')
AND acccnt = -1
--and appnm  in ('EPOS01C6P')
--and famnm = 'Vx-520'
--and famnm = 'Vx-675'
--and famnm = 'Vx-675WiFi'
group by appnm, famnm
order by  famnm  ,appnm


--- Check version for every TID for specific TIDs
select distinct CLUSTERID,termid, appnm, famnm   from vc30.relation where
TERMID IN
 ('01320840','01320841','01557520','01100352')
AND substring(appnm,1,4) = ('PIRA')
 and substring(appnm,9,1) = ('P')
AND acccnt = -1
and appnm  in ('EPOS01C6P')
and famnm = 'Vx-675'
order by famnm,appnm


-- Check version and libraries for all selected TIDs   -- Run before update and after update to check 
select CLUSTERID,famnm,appnm,count(*) from vc30.relation where
TERMID in
('73001095','73001097','73001098','73001099','73001100','73001101','73000718','73002971','73001071','73003491','73005397','73001073','73001076','73002970','73004807','73001078','73001072','73005393','73005391','73001070','73001068','73001075','73002972','73001069','73001066')
group by CLUSTERID,famnm,appnm
ORDER BY CLUSTERID,famnm,appnm



--- Process check report if updated or not

select  distinct  cast(vc30.relation.TERMID as varchar(30)) as TID,
cast(a.[value] as varchar(30)) as MID,
b.[value] as [ΔΙΑΚΡΙΤΙΚΟΣ ΤΙΤΛΟΣ],
c.[value] as [ΔΙΕΥΘΥΝΣΗ],
d.[value] as [ΠΟΛΗ],
e.[value] as [ΤΗΛΕΦΩΝΟ],
o.[value] as [ΣΥΝΔΕΣΗ],
x.evdate as [LAST PARAMETER CALL],                                                                         
vc30.relation.appnm as [MASKED_SOFTWARE],
x.late_versio as [RUNNING_SOFTWARE],                                                                    
vc30.relation.famnm as [ΜΟΝΤΕΛΟ ΤΕΡΜΑΤΙΚΟΥ],
vc30.TERMINFO.datecreated as [BIRTH DATE]
from (vc30.relation
      left join vc30.PARAMETER a on vc30.relation.TERMID=a.PARTID and a.PARNAMELOC = 'MERCHID'
      left join vc30.PARAMETER b on vc30.relation.TERMID=b.PARTID and b.PARNAMELOC = 'RECEIPT_LINE_1'
      left join vc30.PARAMETER c on vc30.relation.TERMID=c.PARTID and c.PARNAMELOC = 'RECEIPT_LINE_2'
      left join vc30.PARAMETER d on vc30.relation.TERMID=d.PARTID and d.PARNAMELOC = 'RECEIPT_LINE_3'
      left join vc30.PARAMETER e on vc30.relation.TERMID=e.PARTID and e.PARNAMELOC = 'RECEIPT_LINE_4'
	  left join vc30.PARAMETER o on vc30.relation.TERMID=o.PARTID and o.PARNAMELOC = 'MEDIA'
      left join vc30.PARAMETER q on vc30.relation.TERMID=q.PARTID and q.PARNAMELOC = 'AUTOCALL'
      left join vc30.TERMINFO    on vc30.relation.TERMID=termid_term
      left join  (select e.*,
case (substring(e.vers_pir,9,1)) when ',' then substring(e.vers_pir,1,8) + 'P' when 'P' then (e.vers_pir) end as late_versio
 from
 (select a.evdate, a.termid, a.appnm , substring(a.appnm,charindex('PIRA', a.appnm),9) vers_pir
 from vc30.termlog a,(select  max(evdate) date_max, termid  from vc30.termlog where
 --RIGHT(vc30.termlog.TERMID,1) = @lstDigiTID and 
 message = 'Download Successful' and status = 'S'
 group by termid) q
 where  a.evdate = q.date_max and a.termid = q.termid and appnm like '%PIRA%')e) x on vc30.relation.TERMID=x.termid
 )
where
vc30.relation.TERMID in 
('01000050','01000070','00001550','00026380','01000200','01000320','01000450','01000510','01000620','01000190','01000300','01000440','01000520','01000530','01000570','01000640','01000700','01000710','01000880','01001050','01001230','01001320','01001410','01001470','01001550','01001750','01001800','01002260','01002430','01002460','01002490','01002510','01002530','01002840','01002970','01002990','01003030','01003110','01003130','01003310','01003360','01003760','01004120','01004220','01004240','01004300','01004310','01004580','01004640','01004650','01004790','01004890','01004990','01005170','01555530','01555610','01555770','01555800','01555860','01555920','01555930','01556000','01556040','01556080','01556240','01556310','01556330','01556450','01556660','01556670','01556720','01556740','01556780','01556800','01556940','01556990','01557130','01557140','01557230','01557300','01557370','01557390','01557470','01557680','01557770','01557930','01558650','01558700','01558890','01559000','01559030','01559250','01559390','01559550','01559560','01559730','01559780','01559810','01559860','01559910','01559930','01559940','01560040','01560160','01560170','01560200','01560220','01560390','01560480','01560620','01560900','01560910','01560970','01560980','01561020','01561030','01561130','01561300','01561340','01561350','01561440','01561530','01561550','01561590','01561780','01561800','01561850','01561950','01562080','01562090','01562330','01562460','01562510','01562560','01562580','01039270','01039400','01039440','01039520','01039550','01562660','01562810','01562930','01039780','01040120','01040500','01563040','01563280','01563330','01563340','01563370','01563520','01563910','01563960','01564020','01564090','01564100','01564220','01564230','01564270','01564300','01564330','01564340','01564370','01564450','01564460','01564500','01564720','01564740','01564770','01564880','01564980','01040860','01040880','01041060','01565030','01565060','01565100','01565330','01041140','01041170','01041360','01041390','01041510','01041530','01041580','01565510','01565600','01565730','01566060','01566170','01566280','01566450','01566590','01566660','01566740','01566750','01566990','01567000','01567060','01567710','01567760','01567790','01567900','01568130','01568220','01568300','01568410','01568460','01568570','01568580','01568610','01568650','01568710','01568770','01568870','01569230','01569380','01569440','01569450','01569570','01569590','01569680','01569730','01569740','01569750','01569850','01570060','01570120','01570480','01570530','01570540','01570620','01570670','01570740','01570790','01570850','01570880','01570940','01571020','01571140','01571190','01571200','01571250','01571390','01571400','01571420','01571490','01571550','01571590','01571680','01571770','01571880','01571910','01571920','01572040','01572240','01572400','01572410','01572550','01572600','01572660','01572740','01572780','01572810','01572960','01572990','01573200','01573220','01573250','01573360','01573370','01573510','01573610','01573640','01573670','01573790','01041770','01041850','01041910','01041990','01573800','01574000','01574320','01574330','01042210','01042400','01042460','01574360','01574540','01574710','01574740','01574950','01575330','01575390','01575470','01575520','01575530','01575790','01575890','01575910','01576050','01576070','01576130','01576220','01576360','01576370','01576470','01576490','01576520','01576530','01576560','01576680','01576980','01577110','01577240','01577350','01577400','01577410','01577530','01577620','01577720','01577920','01578010','01578070','01578110','01578120','01578280','01578310','01578500','01578590','01578630','01578640','01578870','01579040','01579090','01579120','01579260','01579310','01579490','01579590','01579660','01579670','01579750','01579780','01579800','01579810','01579820','01579900','01579930','01579990','01580050','01580090','01580200','01580480','01580670','01580870','01580910','01580960','01581210','01581220','01581390','01581420','01581450','01581530','01581660','01581690','01581730','01581740','01581830','01581890','01582110','01582160','01582200','01582310','01582480','01582500','01582530','01582600','01582630','01586540','01586670','01586680','01586740','01586760','01587130','01587310','01587390','01587540','01587550','01587590','01587740','01587790','01587900','01587920','01587930','01587940','01588050','01588130','01588180','01588240','01588270','01588610','01588680','01588780','01588870','01588880','01588950','01588990','01589010','01589030','01589090','01589110','01589160','01589200','01589220','01589350','01589600','01589970','01590020','01590120','01590380','01590430','01590450','01590560','01590690','01590880','01042530','01042570','01042700','01591020','01591100','01591300','01591500','01042880','01043010','01043050','01043250','01591680','01591700','01591730','01591760','01591850','01591860','01592110','01592250','01592320','01592330','01592500','01592670','01592690','01592730','01592750','01592770','01592850','01592860','01592940','01592970','01592980','01593030','01593150','01593430','01593460','01593470','01593510','01593670','01593700','01593740','01593800','01594040','01594090','01594180','01594350','01594430','01594500','01594520','01594530','01594570','01594680','01594730','01594790','01594850','01594940','01595030','01595070','01595200','01595310','01595350','01595450','01595460','01595560','01595570','01595660','01595690','01595710','01595730','01595750','01595770','01595810','01595890','01595930')
and substring(cast(vc30.relation.appnm as char(10)),9,1) = ('P')
and  vc30.relation.CLUSTERID in ('EPOS_PIRAEUS','EPOS_PIRAEUS_EPP','PIRAEUS')
--AND RIGHT(vc30.relation.TERMID,1) = @lstDigiTID ;


