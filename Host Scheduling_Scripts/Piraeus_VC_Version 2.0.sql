- 1 *NOTE: Ensure that the new app is created first in the target Model using Model/App Manager

declare @FromModel varchar(20)
declare @ToModel varchar(20)
declare @FromAppnm varchar(10)
declare @ToAppnm varchar(10)
declare @FromAppnm1 varchar(10)
declare @ToAppnm1 varchar(10)

-- 2. Modify the 4 variables below accordingly
--

--SET @FromModel='Vx-520'
--SET @ToModel='Vx-520'
 SET @FromModel='Vx-675'
 SET @ToModel='Vx-675'
-- SET @FromModel='Vx-675WiFi'
-- SET @ToModel='Vx-675WiFi'
SET @FromAppnm='PIRA01A6P'
SET @ToAppnm='PIRA0200P'
SET @FromAppnm1='PIRA01A6'
SET @ToAppnm1='PIRA0200'


-- select * from vc30.relation where appnm like 'PIRA%' and substring(appnm,9,1) = 'P' and
-- TERMID in
-- ('01243911','01264461','01286530','01286531','01286532','01286533','01286534','01287811','01287812','01287822','01287823','01287824','01287825','01288470','01288480','01288900','01288970','00020891','00020892','01160441','01224972','01248481','00209931','01071032','01109160','01109161','01122271','01148802','01203321','01224972','01230942','01230951','01234671','01260771','01294472','01298750','01338700','01338920','01339130','01343620','01346720','01346990','01352090','01356320','01360850','01371210','00081813','00081815','00081816','00159781','01072671','01109162','01110931','01150742','01182372','01229642','01229643','01246161','01256981','01264311','01279494','01279495','01285401','01291751','01294811','01295110','01295300','01297250','01297291','01311881','01316340','01317090','01319410','01322970','01333131','01336590','01337220','01346940','01346960','01349580','01352110','01354330','01358350','01359500','01363850','01371980','01079061','01196981','01246571','01279496','01282392','01304061','01312750','01314050','01339350','01339360','01343380','01347910','01364230','01232391','01345840','01346220','01346980','01354320','01302170','01333130','01334940','01371240','00232041','01085732','01243971','01346951','01351900','01352450','00080363','00040132','01244861','01289870','01289860','01344020','01047163','01289161','01372000','01155422','01371970','01298170','01230941','01119731','01282562','01343230','01355620','01289850','01351910','01348410','01338930','01339131','01296831','01347911','01150743','01168421','01300550','01343650','01352100','01349090','01351470','01279497','01260031','01343730','01293581','01294471','01338640','01029452','01273941','01291471','01034956','01184102','01184103','01204013','01232151','01243351','01243911','01264831','01282321','01287661','01287811','01295930','01308000','01308240','01336660','01341500','01351460','01352230','01354851','01354854','01354855','01354856','01354857','01355710','01370690','01072332','01078831','01144422','01220163','01220164','01233042','01233384','01258182','01287812','01304400','01307520','01307522','01308720','01336630')
-- group by famnm,appnm
-- 3 Create new app on all TIDs in the target model based on the TIDs found in the source model and app name combination.

insert into vc30.RELATION
(FAMNM,APPNM,TERMID,CLUSTERID,ACCCNT,LASTFULL,LASTPAR,ACCCODE,VIOLATIONCOUNT,LOCKED,MODON,MODBY,LOCKTIMESTAMP,EPROMID,DESCRIPTION,DLD_STATUS,
ISAUTODOWNLOAD,LAST_ATTEMPTED_DLD_DATE,VERSION,LASTPARAM_DLD_DATE,LASTFILE_DLD_DATE,FORUSES,FORMVIEWTYPE,SERVERID,TERM_FILE_UPDATES,
FORCEFILEDLD,FORCEPARAMDLD,FORCETERMFILEDLD)
select @ToModel,@ToAppnm,TERMID,CLUSTERID,ACCCNT,NULL,NULL,ACCCODE,0,LOCKED,getdate(),
'SCRIPT1',NULL,NULL,DESCRIPTION,NULL,'N',NULL,NULL,NULL,NULL,FORUSES,FORMVIEWTYPE,NULL,TERM_FILE_UPDATES,'D','D','D'
from vc30.relation
where famnm = @FromModel and appnm = @FromAppnm
-- for specific terminal
and TERMID in

('01228761')

-- 4 Create new parameters app on all TIDs in the target model based on the TIDs found in the source model and app name combination.
insert into vc30.RELATION
(FAMNM,APPNM,TERMID,CLUSTERID,ACCCNT,LASTFULL,LASTPAR,ACCCODE,VIOLATIONCOUNT,LOCKED,MODON,MODBY,LOCKTIMESTAMP,EPROMID,DESCRIPTION,DLD_STATUS,
ISAUTODOWNLOAD,LAST_ATTEMPTED_DLD_DATE,VERSION,LASTPARAM_DLD_DATE,LASTFILE_DLD_DATE,FORUSES,FORMVIEWTYPE,SERVERID,TERM_FILE_UPDATES,
FORCEFILEDLD,FORCEPARAMDLD,FORCETERMFILEDLD)
select @ToModel,@ToAppnm1,TERMID,CLUSTERID,ACCCNT,NULL,NULL,ACCCODE,0,LOCKED,getdate(),
'SCRIPT1',NULL,NULL,DESCRIPTION,NULL,'N',NULL,NULL,NULL,NULL,FORUSES,FORMVIEWTYPE,NULL,TERM_FILE_UPDATES,'D','D','D'
from vc30.relation
where famnm = @FromModel and appnm = @FromAppnm1
-- for specific terminal
and TERMID in

('01228761')

-- 5 Copy parameters from source app to target app
insert into vc30.PARAMETER (FAMNM, APPNM, PARTID, PARNAMELOC, SEQINFO, DLDTYPE,PARINFO, VALUE,PSIZE,FLAG)
select @ToModel model,@ToAppnm, PARTID, PARNAMELOC, SEQINFO, DLDTYPE,PARINFO, VALUE,PSIZE,FLAG
from vc30.parameter
where famnm = @FromModel and appnm in (@FromAppnm, @FromAppnm1)
-- for specific terminal
and PARTID in

('01228761')

-- Copy Parameters from one app to another app
-- 1 *NOTE: Ensure that the new app is created first in the target Model using Model/App Manager


-- -- update the file paths
-- update vc30.term_dld_files
-- set appnm = @ToAppnm, serfilenm = replace(serfilenm,'\\HUBP1-POS-MG1P.commonpr.eeft.com\VCApps\LiveEvoApps\PIRAEUSBANK\PIRA_01A3','\\HUBP1-POS-MG1P.commonpr.eeft.com\VCApps\LiveEvoApps\PIRAEUSBANK\PIRA_01A4')
-- where serfilenm like '\\HUBP1-POS-MG1P.commonpr.eeft.com\VCApps\LiveEvoApps\PIRAEUSBANK\PIRA_01A3%'
-- and famnm = @FromModel and appnm = @FromAppnm
-- -- for specific terminal
update vc30.term_dld_files
set appnm = @ToAppnm
where famnm = @FromModel and appnm = @FromAppnm
AND termid in

('01228761')

--------------------------------------------------

-- select * from vc30.term_dld_files
--  where termid in
-- ('01243911','01264461','01286530','01286531','01286532','01286533','01286534','01287811','01287812','01287822','01287823','01287824','01287825','01288470','01288480','01288900','01288970','00020891','00020892','01160441','01224972','01248481','00209931','01071032','01109160','01109161','01122271','01148802','01203321','01224972','01230942','01230951','01234671','01260771','01294472','01298750','01338700','01338920','01339130','01343620','01346720','01346990','01352090','01356320','01360850','01371210','00081813','00081815','00081816','00159781','01072671','01109162','01110931','01150742','01182372','01229642','01229643','01246161','01256981','01264311','01279494','01279495','01285401','01291751','01294811','01295110','01295300','01297250','01297291','01311881','01316340','01317090','01319410','01322970','01333131','01336590','01337220','01346940','01346960','01349580','01352110','01354330','01358350','01359500','01363850','01371980','01079061','01196981','01246571','01279496','01282392','01304061','01312750','01314050','01339350','01339360','01343380','01347910','01364230','01232391','01345840','01346220','01346980','01354320','01302170','01333130','01334940','01371240','00232041','01085732','01243971','01346951','01351900','01352450','00080363','00040132','01244861','01289870','01289860','01344020','01047163','01289161','01372000','01155422','01371970','01298170','01230941','01119731','01282562','01343230','01355620','01289850','01351910','01348410','01338930','01339131','01296831','01347911','01150743','01168421','01300550','01343650','01352100','01349090','01351470','01279497','01260031','01343730','01293581','01294471','01338640','01029452','01273941','01291471','01034956','01184102','01184103','01204013','01232151','01243351','01243911','01264831','01282321','01287661','01287811','01295930','01308000','01308240','01336660','01341500','01351460','01352230','01354851','01354854','01354855','01354856','01354857','01355710','01370690','01072332','01078831','01144422','01220163','01220164','01233042','01233384','01258182','01287812','01304400','01307520','01307522','01308720','01336630')
--

-- 6.1 Delete old parameters
delete from vc30.RELATION
where famnm = @FromModel and appnm = @FromAppnm
-- for specific terminal
and TERMID in

('01228761')

-- 6.2 Delete old parameters
delete from vc30.RELATION
where famnm = @FromModel and appnm = @FromAppnm1
-- for specific terminal
and TERMID in
('01228761')

GO




---- USES
select value,count(*) from vc30.PARAMETER where parnameloc = 'USES' and partid in
('01228761')
group by value


update vc30.PARAMETER set value = 'TPIRA0200P' where parnameloc = 'USES' and partid in
('01228761')


------- UNZIP
select value,count(*) from vc30.PARAMETER where parnameloc = '*unzip' and partid in
('01228761')
group by value

delete from vc30.PARAMETER where parnameloc = '*unzip' and partid in
('01228761')
